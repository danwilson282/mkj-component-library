import{h as j,g as q}from"./SelectionManager-CI14lW-F.js";import{a as z}from"./useId-DkSsBc6l.js";import{$ as G}from"./chain-Cz8Y3ew1.js";import{$ as A}from"./mergeProps-BSYFvk6G.js";import{$ as H,r as S,l as J}from"./iframe-D8dPSlhY.js";import{$ as Q}from"./keyboard-B0W89dhJ.js";import{$ as W}from"./usePress-u4jOjUB7.js";import{$ as X}from"./useLongPress-CIZyeTXo.js";import{$ as Y}from"./focusSafely-C0rkqf8u.js";import{b as Z}from"./useSelectableCollection-CZOwsHdO.js";function ae(r){let{id:g,selectionManager:t,key:o,ref:i,shouldSelectOnPressUp:O,shouldUseVirtualFocus:c,focus:D,isDisabled:l,onAction:$,allowsDifferentPressOrigin:C,linkBehavior:a="action"}=r,x=H();g=z(g);let f=e=>{if(e.pointerType==="keyboard"&&q(e))t.toggleSelection(o);else{if(t.selectionMode==="none")return;if(t.isLink(o)){if(a==="selection"&&i.current){let d=t.getItemProps(o);x.open(i.current,e,d.href,d.routerOptions),t.setSelectedKeys(t.selectedKeys);return}else if(a==="override"||a==="none")return}t.selectionMode==="single"?t.isSelected(o)&&!t.disallowEmptySelection?t.toggleSelection(o):t.replaceSelection(o):e&&e.shiftKey?t.extendSelection(o):t.selectionBehavior==="toggle"||e&&(Q(e)||e.pointerType==="touch"||e.pointerType==="virtual")?t.toggleSelection(o):t.replaceSelection(o)}};S.useEffect(()=>{o===t.focusedKey&&t.isFocused&&(c?Z(i.current):D?D():document.activeElement!==i.current&&i.current&&Y(i.current))},[i,o,t.focusedKey,t.childFocusStrategy,t.isFocused,c]),l=l||t.isDisabled(o);let u={};!c&&!l?u={tabIndex:o===t.focusedKey?0:-1,onFocus(e){e.target===i.current&&t.setFocusedKey(o)}}:l&&(u.onMouseDown=e=>{e.preventDefault()});let B=t.isLink(o)&&a==="override",L=$&&r.UNSTABLE_itemBehavior==="action",F=t.isLink(o)&&a!=="selection"&&a!=="none",n=!l&&t.canSelectItem(o)&&!B&&!L,h=($||F)&&!l,p=h&&(t.selectionBehavior==="replace"?!n:!n||t.isEmpty),k=h&&n&&t.selectionBehavior==="replace",y=p||k,m=S.useRef(null),P=y&&n,T=S.useRef(!1),w=S.useRef(!1),b=t.getItemProps(o),v=e=>{if($){var d;$(),(d=i.current)===null||d===void 0||d.dispatchEvent(new CustomEvent("react-aria-item-action",{bubbles:!0}))}F&&i.current&&x.open(i.current,e,b.href,b.routerOptions)},s={ref:i};if(O?(s.onPressStart=e=>{m.current=e.pointerType,T.current=P,e.pointerType==="keyboard"&&(!y||K())&&f(e)},C?(s.onPressUp=p?void 0:e=>{e.pointerType==="mouse"&&n&&f(e)},s.onPress=p?v:e=>{e.pointerType!=="keyboard"&&e.pointerType!=="mouse"&&n&&f(e)}):s.onPress=e=>{if(p||k&&e.pointerType!=="mouse"){if(e.pointerType==="keyboard"&&!E())return;v(e)}else e.pointerType!=="keyboard"&&n&&f(e)}):(s.onPressStart=e=>{m.current=e.pointerType,T.current=P,w.current=p,n&&(e.pointerType==="mouse"&&!p||e.pointerType==="keyboard"&&(!h||K()))&&f(e)},s.onPress=e=>{(e.pointerType==="touch"||e.pointerType==="pen"||e.pointerType==="virtual"||e.pointerType==="keyboard"&&y&&E()||e.pointerType==="mouse"&&w.current)&&(y?v(e):n&&f(e))}),u["data-collection"]=j(t.collection),u["data-key"]=o,s.preventFocusOnPress=c,c&&(s=A(s,{onPressStart(e){e.pointerType!=="touch"&&(t.setFocused(!0),t.setFocusedKey(o))},onPress(e){e.pointerType==="touch"&&(t.setFocused(!0),t.setFocusedKey(o))}})),b)for(let e of["onPressStart","onPressEnd","onPressChange","onPress","onPressUp","onClick"])b[e]&&(s[e]=G(s[e],b[e]));let{pressProps:U,isPressed:I}=W(s),M=k?e=>{m.current==="mouse"&&(e.stopPropagation(),e.preventDefault(),v(e))}:void 0,{longPressProps:R}=X({isDisabled:!P,onLongPress(e){e.pointerType==="touch"&&(f(e),t.setSelectionBehavior("toggle"))}}),V=e=>{m.current==="touch"&&T.current&&e.preventDefault()},N=a!=="none"&&t.isLink(o)?e=>{J.isOpening||e.preventDefault()}:void 0;return{itemProps:A(u,n||p||c&&!l?U:{},P?R:{},{onDoubleClick:M,onDragStartCapture:V,onClick:N,id:g},c?{onMouseDown:e=>e.preventDefault()}:void 0),isPressed:I,isSelected:t.isSelected(o),isFocused:t.isFocused&&t.focusedKey===o,isDisabled:l,allowsSelection:n,hasAction:y}}function E(){let r=window.event;return r?.key==="Enter"}function K(){let r=window.event;return r?.key===" "||r?.code==="Space"}export{ae as $};
