import{b as y}from"./FocusScope-D88eWPww.js";import{$ as x}from"./useFocusWithin-BGfq9Bt7.js";import{a as h}from"./utils-U1MD0fLI.js";import{a as $}from"./useEffectEvent-jkaMIIQr.js";import{r as D}from"./iframe-D8dPSlhY.js";function I(n){let{ref:t,onInteractOutside:i,isDisabled:c,onInteractOutsideStart:f}=n,a=D.useRef({isPointerDown:!1,ignoreEmulatedMouseEvents:!1}),s=$(r=>{i&&E(r,t)&&(f&&f(r),a.current.isPointerDown=!0)}),d=$(r=>{i&&i(r)});D.useEffect(()=>{let r=a.current;if(c)return;const u=t.current,l=h(u);if(typeof PointerEvent<"u"){let p=b=>{r.isPointerDown&&E(b,t)&&d(b),r.isPointerDown=!1};return l.addEventListener("pointerdown",s,!0),l.addEventListener("click",p,!0),()=>{l.removeEventListener("pointerdown",s,!0),l.removeEventListener("click",p,!0)}}},[t,c,s,d])}function E(n,t){if(n.button>0)return!1;if(n.target){const i=n.target.ownerDocument;if(!i||!i.documentElement.contains(n.target)||n.target.closest("[data-react-aria-top-layer]"))return!1}return t.current?!n.composedPath().includes(t.current):!1}var o=[];function S(n,t){const{disableOutsideEvents:i=!0,isDismissable:c=!1,isKeyboardDismissDisabled:f=!1,isOpen:a,onClose:s,shouldCloseOnBlur:d,shouldCloseOnInteractOutside:r}=n;D.useEffect(()=>{if(a&&!o.includes(t))return o.push(t),()=>{let e=o.indexOf(t);e>=0&&o.splice(e,1)}},[a,t]);const u=()=>{o[o.length-1]===t&&s&&s()},l=e=>{(!r||r(e.target))&&(o[o.length-1]===t&&i&&(e.stopPropagation(),e.preventDefault()),P(t)!=="pressEnd"&&u())},p=e=>{(!r||r(e.target))&&(o[o.length-1]===t&&i&&(e.stopPropagation(),e.preventDefault()),u())},b=e=>{e.key==="Escape"&&!f&&!e.nativeEvent.isComposing&&(e.stopPropagation(),e.preventDefault(),u())};I({isDisabled:!(c&&a),onInteractOutside:c&&a?p:void 0,onInteractOutsideStart:l,ref:t});const{focusWithinProps:w}=x({isDisabled:!d,onBlurWithin:e=>{!e.relatedTarget||y(e.relatedTarget)||(!r||r(e.relatedTarget))&&u()}}),O=e=>{e.target===e.currentTarget&&e.preventDefault()};function P(e){const g=e.current;if(!g)return"unknown";const m=(g.getAttribute("role")||"").toLowerCase(),v=g.getAttribute("aria-modal");return(m==="dialog"||m==="alertdialog")&&(v===null||v.toLowerCase()==="true")?"pressEnd":["listbox","menu","tree","grid","combobox"].includes(m)?"pressStart":"unknown"}return{overlayProps:{onKeyDown:b,...w},underlayProps:{onPointerDown:O}}}export{S as u};
