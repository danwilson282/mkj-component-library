import{r as s,M as A,j as y,s as z}from"./iframe-D8dPSlhY.js";import{P as v,u as D,L as H}from"./PresenceContext-CgaSYtSC.js";import{i as K}from"./is-html-element-DDM1wWmV.js";function k(e,o){if(typeof e=="function")return e(o);e!=null&&(e.current=o)}function U(...e){return o=>{let n=!1;const r=e.map(i=>{const t=k(i,o);return!n&&typeof t=="function"&&(n=!0),t});if(n)return()=>{for(let i=0;i<r.length;i++){const t=r[i];typeof t=="function"?t():k(e[i],null)}}}}function B(...e){return s.useCallback(U(...e),e)}class F extends s.Component{getSnapshotBeforeUpdate(o){const n=this.props.childRef.current;if(n&&o.isPresent&&!this.props.isPresent){const r=n.offsetParent,i=K(r)&&r.offsetWidth||0,t=this.props.sizeRef.current;t.height=n.offsetHeight||0,t.width=n.offsetWidth||0,t.top=n.offsetTop,t.left=n.offsetLeft,t.right=i-t.width-t.left}return null}componentDidUpdate(){}render(){return this.props.children}}function G({children:e,isPresent:o,anchorX:n,root:r}){const i=s.useId(),t=s.useRef(null),a=s.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:x}=s.useContext(A),P=B(t,e?.ref);return s.useInsertionEffect(()=>{const{width:u,height:g,top:f,left:d,right:p}=a.current;if(o||!t.current||!u||!g)return;const m=n==="left"?`left: ${d}`:`right: ${p}`;t.current.dataset.motionPopId=i;const l=document.createElement("style");x&&(l.nonce=x);const E=r??document.head;return E.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${i}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${g}px !important;
            ${m}px !important;
            top: ${f}px !important;
          }
        `),()=>{E.contains(l)&&E.removeChild(l)}},[o]),y.jsx(F,{isPresent:o,childRef:t,sizeRef:a,children:s.cloneElement(e,{ref:P})})}const V=({children:e,initial:o,isPresent:n,onExitComplete:r,custom:i,presenceAffectsLayout:t,mode:a,anchorX:x,root:P})=>{const u=z(X),g=s.useId();let f=!0,d=s.useMemo(()=>(f=!1,{id:g,initial:o,isPresent:n,custom:i,onExitComplete:p=>{u.set(p,!0);for(const m of u.values())if(!m)return;r&&r()},register:p=>(u.set(p,!1),()=>u.delete(p))}),[n,u,r]);return t&&f&&(d={...d}),s.useMemo(()=>{u.forEach((p,m)=>u.set(m,!1))},[n]),s.useEffect(()=>{!n&&!u.size&&r&&r()},[n]),a==="popLayout"&&(e=y.jsx(G,{isPresent:n,anchorX:x,root:P,children:e})),y.jsx(v.Provider,{value:d,children:e})};function X(){return new Map}function _(e=!0){const o=s.useContext(v);if(o===null)return[!0,null];const{isPresent:n,onExitComplete:r,register:i}=o,t=s.useId();s.useEffect(()=>{if(e)return i(t)},[e]);const a=s.useCallback(()=>e&&r&&r(t),[t,r,e]);return!n&&r?[!1,a]:[!0]}function Q(){return q(s.useContext(v))}function q(e){return e===null?!0:e.isPresent}const M=e=>e.key||"";function L(e){const o=[];return s.Children.forEach(e,n=>{s.isValidElement(n)&&o.push(n)}),o}const Y=({children:e,custom:o,initial:n=!0,onExitComplete:r,presenceAffectsLayout:i=!0,mode:t="sync",propagate:a=!1,anchorX:x="left",root:P})=>{const[u,g]=_(a),f=s.useMemo(()=>L(e),[e]),d=a&&!u?[]:f.map(M),p=s.useRef(!0),m=s.useRef(f),l=z(()=>new Map),[E,T]=s.useState(f),[C,I]=s.useState(f);D(()=>{p.current=!1,m.current=f;for(let h=0;h<C.length;h++){const c=M(C[h]);d.includes(c)?l.delete(c):l.get(c)!==!0&&l.set(c,!1)}},[C,d.length,d.join("-")]);const w=[];if(f!==E){let h=[...f];for(let c=0;c<C.length;c++){const R=C[c],j=M(R);d.includes(j)||(h.splice(c,0,R),w.push(R))}return t==="wait"&&w.length&&(h=w),I(L(h)),T(f),null}const{forceRender:S}=s.useContext(H);return y.jsx(y.Fragment,{children:C.map(h=>{const c=M(h),R=a&&!u?!1:f===C||d.includes(c),j=()=>{if(l.has(c))l.set(c,!0);else return;let $=!0;l.forEach(W=>{W||($=!1)}),$&&(S?.(),I(m.current),a&&g?.(),r&&r())};return y.jsx(V,{isPresent:R,initial:!p.current||n?void 0:!1,custom:o,presenceAffectsLayout:i,mode:t,root:P,onExitComplete:R?void 0:j,anchorX:x,children:h},c)})})};export{Y as A,G as P,V as a,B as b,Q as c,_ as u};
