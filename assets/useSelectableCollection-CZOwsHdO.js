import{d as N,e as ve,f as pe,g as q}from"./SelectionManager-CI14lW-F.js";import{a as $e,$ as ee}from"./utils-U1MD0fLI.js";import{$ as G}from"./mergeProps-BSYFvk6G.js";import{r as d,e as be,$ as ye,i as g,v as Ke}from"./iframe-D8dPSlhY.js";import{$ as J,a as Q}from"./useEffectEvent-jkaMIIQr.js";import{$ as D}from"./useEvent-Bz-VwyyX.js";import{$ as me,a as X}from"./scrollIntoView-Dt_QIPhm.js";import{$ as E}from"./keyboard-B0W89dhJ.js";import{$ as xe}from"./FocusScope-D88eWPww.js";import{d as Y}from"./useFocusVisible-C8HhheBG.js";import{$ as Z}from"./focusSafely-C0rkqf8u.js";function _(i,e){const t=d.useRef(!0),c=d.useRef(null);J(()=>(t.current=!0,()=>{t.current=!1}),[]),J(()=>{t.current?t.current=!1:(!c.current||e.some((m,y)=>!Object.is(m,c[y])))&&i(),c.current=e},e)}const Fe="react-aria-clear-focus",he="react-aria-focus";function Ee(i){let e=we($e(i));e!==i&&(e&&Te(e,i),i&&le(i,e))}function Te(i,e){i.dispatchEvent(new FocusEvent("blur",{relatedTarget:e})),i.dispatchEvent(new FocusEvent("focusout",{bubbles:!0,relatedTarget:e}))}function le(i,e){i.dispatchEvent(new FocusEvent("focus",{relatedTarget:e})),i.dispatchEvent(new FocusEvent("focusin",{bubbles:!0,relatedTarget:e}))}function we(i){let e=ee(i),t=e?.getAttribute("aria-activedescendant");return t&&i.getElementById(t)||e}function Ne(i){let{selectionManager:e,keyboardDelegate:t,ref:c,autoFocus:m=!1,shouldFocusWrap:y=!1,disallowEmptySelection:te=!1,disallowSelectAll:re=!1,escapeKeyBehavior:oe="clearSelection",selectOnFocus:x=e.selectionBehavior==="replace",disallowTypeAhead:ce=!1,shouldUseVirtualFocus:K,allowsTabNavigation:ne=!1,isVirtualized:U,scrollRef:a=c,linkBehavior:V="action"}=i,{direction:T}=be(),ie=ye(),fe=l=>{var o;if(l.altKey&&l.key==="Tab"&&l.preventDefault(),!(!((o=c.current)===null||o===void 0)&&o.contains(l.target)))return;const n=(r,$)=>{if(r!=null){if(e.isLink(r)&&V==="selection"&&x&&!q(l)){Ke.flushSync(()=>{e.setFocusedKey(r,$)});let b=N(c,r),j=e.getItemProps(r);b&&ie.open(b,l,j.href,j.routerOptions);return}if(e.setFocusedKey(r,$),e.isLink(r)&&V==="override")return;l.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(r):x&&!q(l)&&e.replaceSelection(r)}};switch(l.key){case"ArrowDown":if(t.getKeyBelow){var f,s,u;let r=e.focusedKey!=null?(f=t.getKeyBelow)===null||f===void 0?void 0:f.call(t,e.focusedKey):(s=t.getFirstKey)===null||s===void 0?void 0:s.call(t);r==null&&y&&(r=(u=t.getFirstKey)===null||u===void 0?void 0:u.call(t,e.focusedKey)),r!=null&&(l.preventDefault(),n(r))}break;case"ArrowUp":if(t.getKeyAbove){var v,p,R;let r=e.focusedKey!=null?(v=t.getKeyAbove)===null||v===void 0?void 0:v.call(t,e.focusedKey):(p=t.getLastKey)===null||p===void 0?void 0:p.call(t);r==null&&y&&(r=(R=t.getLastKey)===null||R===void 0?void 0:R.call(t,e.focusedKey)),r!=null&&(l.preventDefault(),n(r))}break;case"ArrowLeft":if(t.getKeyLeftOf){var k,M,B;let r=e.focusedKey!=null?(k=t.getKeyLeftOf)===null||k===void 0?void 0:k.call(t,e.focusedKey):null;r==null&&y&&(r=T==="rtl"?(M=t.getFirstKey)===null||M===void 0?void 0:M.call(t,e.focusedKey):(B=t.getLastKey)===null||B===void 0?void 0:B.call(t,e.focusedKey)),r!=null&&(l.preventDefault(),n(r,T==="rtl"?"first":"last"))}break;case"ArrowRight":if(t.getKeyRightOf){var I,O,z;let r=e.focusedKey!=null?(I=t.getKeyRightOf)===null||I===void 0?void 0:I.call(t,e.focusedKey):null;r==null&&y&&(r=T==="rtl"?(O=t.getLastKey)===null||O===void 0?void 0:O.call(t,e.focusedKey):(z=t.getFirstKey)===null||z===void 0?void 0:z.call(t,e.focusedKey)),r!=null&&(l.preventDefault(),n(r,T==="rtl"?"last":"first"))}break;case"Home":if(t.getFirstKey){if(e.focusedKey===null&&l.shiftKey)return;l.preventDefault();let r=t.getFirstKey(e.focusedKey,E(l));e.setFocusedKey(r),r!=null&&(E(l)&&l.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(r):x&&e.replaceSelection(r))}break;case"End":if(t.getLastKey){if(e.focusedKey===null&&l.shiftKey)return;l.preventDefault();let r=t.getLastKey(e.focusedKey,E(l));e.setFocusedKey(r),r!=null&&(E(l)&&l.shiftKey&&e.selectionMode==="multiple"?e.extendSelection(r):x&&e.replaceSelection(r))}break;case"PageDown":if(t.getKeyPageBelow&&e.focusedKey!=null){let r=t.getKeyPageBelow(e.focusedKey);r!=null&&(l.preventDefault(),n(r))}break;case"PageUp":if(t.getKeyPageAbove&&e.focusedKey!=null){let r=t.getKeyPageAbove(e.focusedKey);r!=null&&(l.preventDefault(),n(r))}break;case"a":E(l)&&e.selectionMode==="multiple"&&re!==!0&&(l.preventDefault(),e.selectAll());break;case"Escape":oe==="clearSelection"&&!te&&e.selectedKeys.size!==0&&(l.stopPropagation(),l.preventDefault(),e.clearSelection());break;case"Tab":if(!ne){if(l.shiftKey)c.current.focus();else{let r=xe(c.current,{tabbable:!0}),$,b;do b=r.lastChild(),b&&($=b);while(b);$&&!$.contains(document.activeElement)&&g($)}break}}},S=d.useRef({top:0,left:0});D(a,"scroll",U?void 0:()=>{var l,o,n,f;S.current={top:(n=(l=a.current)===null||l===void 0?void 0:l.scrollTop)!==null&&n!==void 0?n:0,left:(f=(o=a.current)===null||o===void 0?void 0:o.scrollLeft)!==null&&f!==void 0?f:0}});let ue=l=>{if(e.isFocused){l.currentTarget.contains(l.target)||e.setFocused(!1);return}if(l.currentTarget.contains(l.target)){if(e.setFocused(!0),e.focusedKey==null){var o,n;let u=p=>{p!=null&&(e.setFocusedKey(p),x&&!e.isSelected(p)&&e.replaceSelection(p))},v=l.relatedTarget;var f,s;v&&l.currentTarget.compareDocumentPosition(v)&Node.DOCUMENT_POSITION_FOLLOWING?u((f=e.lastSelectedKey)!==null&&f!==void 0?f:(o=t.getLastKey)===null||o===void 0?void 0:o.call(t)):u((s=e.firstSelectedKey)!==null&&s!==void 0?s:(n=t.getFirstKey)===null||n===void 0?void 0:n.call(t))}else!U&&a.current&&(a.current.scrollTop=S.current.top,a.current.scrollLeft=S.current.left);if(e.focusedKey!=null&&a.current){let u=N(c,e.focusedKey);u instanceof HTMLElement&&(!u.contains(document.activeElement)&&!K&&g(u),Y()==="keyboard"&&X(u,{containingElement:c.current}))}}},se=l=>{l.currentTarget.contains(l.relatedTarget)||e.setFocused(!1)},F=d.useRef(!1);D(c,he,K?l=>{let{detail:o}=l;l.stopPropagation(),e.setFocused(!0),o?.focusStrategy==="first"&&(F.current=!0)}:void 0);let L=Q(()=>{var l,o;let n=(o=(l=t.getFirstKey)===null||l===void 0?void 0:l.call(t))!==null&&o!==void 0?o:null;if(n==null){let f=ee();Ee(c.current),le(f,null),e.collection.size>0&&(F.current=!1)}else e.setFocusedKey(n),F.current=!1});_(()=>{F.current&&L()},[e.collection,L]);let H=Q(()=>{e.collection.size>0&&(F.current=!1)});_(()=>{H()},[e.focusedKey,H]),D(c,Fe,K?l=>{var o;l.stopPropagation(),e.setFocused(!1),!((o=l.detail)===null||o===void 0)&&o.clearFocusKey&&e.setFocusedKey(null)}:void 0);const W=d.useRef(m),w=d.useRef(!1);d.useEffect(()=>{if(W.current){var l,o;let s=null;var n;m==="first"&&(s=(n=(l=t.getFirstKey)===null||l===void 0?void 0:l.call(t))!==null&&n!==void 0?n:null);var f;m==="last"&&(s=(f=(o=t.getLastKey)===null||o===void 0?void 0:o.call(t))!==null&&f!==void 0?f:null);let u=e.selectedKeys;if(u.size){for(let v of u)if(e.canSelectItem(v)){s=v;break}}e.setFocused(!0),e.setFocusedKey(s),s==null&&!K&&c.current&&Z(c.current),e.collection.size>0&&(W.current=!1,w.current=!0)}});let A=d.useRef(e.focusedKey),h=d.useRef(null);d.useEffect(()=>{if(e.isFocused&&e.focusedKey!=null&&(e.focusedKey!==A.current||w.current)&&a.current&&c.current){let l=Y(),o=N(c,e.focusedKey);if(!(o instanceof HTMLElement))return;(l==="keyboard"||w.current)&&(h.current&&cancelAnimationFrame(h.current),h.current=requestAnimationFrame(()=>{a.current&&(me(a.current,o),l!=="virtual"&&X(o,{containingElement:c.current}))}))}!K&&e.isFocused&&e.focusedKey==null&&A.current!=null&&c.current&&Z(c.current),A.current=e.focusedKey,w.current=!1}),d.useEffect(()=>()=>{h.current&&cancelAnimationFrame(h.current)},[]),D(c,"react-aria-focus-scope-restore",l=>{l.preventDefault(),e.setFocused(!0)});let P={onKeyDown:fe,onFocus:ue,onBlur:se,onMouseDown(l){a.current===l.target&&l.preventDefault()}},{typeSelectProps:ae}=ve({keyboardDelegate:t,selectionManager:e});ce||(P=G(ae,P));let C;K||(C=e.focusedKey==null?0:-1);let de=pe(e.collection);return{collectionProps:G(P,{tabIndex:C,"data-collection":de})}}export{Ne as $,le as a,Ee as b};
